{"title":"理解美团点评分布式ID生成系统--Leaf","date":"2020-06-11T12:00:00.000Z","date_formatted":{"ll":"2020年6月11日","L":"2020/06/11","MM-DD":"06-11"},"author":"Nanzet","link":"2020/06/11/了解美团点评分布式ID生成系统--Leaf","tags":["分布式唯一ID"],"categories":["技术"],"updated":"2022-11-19T15:43:12.598Z","content":"<h4 id=\"1、**开源项目地址：**https://github.com/meituan-dianping/leaf\">1、**开源项目地址：**<a href=\"https://github.com/Meituan-Dianping/Leaf\">https://github.com/Meituan-Dianping/Leaf</a><a title=\"#1、**开源项目地址：**https://github.com/meituan-dianping/leaf\" href=\"#1、**开源项目地址：**https://github.com/meituan-dianping/leaf\"></a></h4>\n<h4 id=\"2、**原理：**https://tech.meituan.com/2017/04/21/mt-leaf.html\">2、**原理：**<a href=\"https://tech.meituan.com/2017/04/21/mt-leaf.html\">https://tech.meituan.com/2017/04/21/mt-leaf.html</a><a title=\"#2、**原理：**https://tech.meituan.com/2017/04/21/mt-leaf.html\" href=\"#2、**原理：**https://tech.meituan.com/2017/04/21/mt-leaf.html\"></a></h4>\n<h4 id=\"3、安装：\">3、<strong>安装：</strong><a title=\"#3、安装：\" href=\"#3、安装：\"></a></h4>\n<ul>\n<li>\n<p>MySQL 8.0.20（<a href=\"https://www.runoob.com/w3cnote/windows10-mysql-installer.html\" target=\"_blank\">安装</a>）</p>\n</li>\n<li>\n<p>java环境（<a href=\"https://www.runoob.com/java/java-environment-setup.html\" target=\"_blank\">安装</a>）</p>\n</li>\n<li>\n<p>maven（是一个项目管理工具，可以对 Java 项目进行构建、依赖管理。<a href=\"https://www.runoob.com/maven/maven-tutorial.html\" target=\"_blank\">教程</a>）</p>\n</li>\n<li>\n<p>zookeeper（一个分布式的，开放源码的分布式应用程序协调服务，是Hadoop和Hbase的重要组件。它是一个为分布式应用提供一致性服务的软件，提供的功能包括：配置维护、域名服务、分布式同步、组服务等。<a href=\"https://blog.csdn.net/weixin_39249427/article/details/99637734\" target=\"_blank\">安装</a>）</p>\n</li>\n</ul>\n<h4 id=\"4、对比开源项目需要做的兼容mysql-8的修改：\">4、<strong>对比开源项目需要做的兼容mysql 8的修改：</strong><a title=\"#4、对比开源项目需要做的兼容mysql-8的修改：\" href=\"#4、对比开源项目需要做的兼容mysql-8的修改：\"></a></h4>\n<p>参考：</p>\n<blockquote>\n<p>a. <a href=\"https://blog.csdn.net/qq_39455116/article/details/99458001?utm_medium=distribute.pc_relevant.none-task-blog-baidujs-5\" target=\"_blank\">基于MySQL8.0美团leaf测试分布式ID生成系统</a></p>\n<p>b. <a href=\"https://www.jianshu.com/p/bd6b00e5f5ac\" target=\"_blank\">Leaf：美团的分布式唯一ID方案深入剖析</a></p>\n</blockquote>\n<p><strong>修改1：</strong></p>\n<p> 父目录下的pom文件修改MySQL版本号：</p>\n<p> 查看版本:</p>\n<p><img src=\"https://raw.githubusercontent.com/Nanzet/nanzet-imgs/master/images/2020061001.jpg\" alt=\"\" loading=\"lazy\" class=\"φbp\"></p>\n<p> 修改pom.xml文件：</p>\n<p><code>&lt;mysql-connector-java.version&gt;8.0.20&lt;/mysql-connector-java.version&gt;</code></p>\n<p><strong>修改2：</strong></p>\n<p> 数据库的设置，修改文件leaf.properties：</p>\n<pre><code>leaf.name=com.sankuai.leaf.opensource.test\n# segment模式开关，这种模式依赖数据库\nleaf.segment.enable=true\nleaf.jdbc.url=jdbc:mysql://localhost:3306/leaf?autoReconnect=true&amp;useSSL=false&amp;serverTimezone=Asia/Shanghai\nleaf.jdbc.driver-class-name=com.mysql.cj.jdbc.Driver\nleaf.jdbc.username=root\nleaf.jdbc.password=xxxxx\n\n# snowflake模式，这种模式依赖zookeeper\nleaf.snowflake.enable=true\nleaf.snowflake.zk.address=127.0.0.1:2181\nleaf.snowflake.port=9099\n</code></pre>\n<p><strong>修改3：</strong></p>\n<p> 修改xxx\\Leaf\\leaf-server\\src\\main\\java\\com\\sankuai\\inf\\leaf\\server\\Constants.java，Constants类添加driver支持：</p>\n<p><code>public static final String driver = &quot;leaf.jdbc.driver-class-name&quot;;</code></p>\n<p><img src=\"https://raw.githubusercontent.com/Nanzet/nanzet-imgs/master/images/2020061002.png\" alt=\"\" loading=\"lazy\" class=\"φbp\"></p>\n<p><strong>修改4：</strong></p>\n<p> 修改xxx\\Leaf\\leaf-server\\src\\main\\java\\com\\sankuai\\inf\\leaf\\server\\service\\SegmentService.java，SegmentService类下面添加driver支持：</p>\n<p><code>dataSource.setDriverClassName(properties.getProperty(Constants.driver));</code></p>\n<p><img src=\"https://raw.githubusercontent.com/Nanzet/nanzet-imgs/master/images/2020061003.png\" alt=\"\" loading=\"lazy\" class=\"φbp\"></p>\n<p> mvn方式运行服务：</p>\n<p><code>mvn spring-boot:run</code></p>\n<p><img src=\"https://raw.githubusercontent.com/Nanzet/nanzet-imgs/master/images/2020061004.jpg\" alt=\"\" loading=\"lazy\" class=\"φbp\"></p>\n<p> Snowflake和Segment两种获取唯一ID的模式的访问方式如下：</p>\n<pre><code># Segment模式获取唯一ID\nhttp://localhost:8080/api/segment/get/pay\nhttp://localhost:8080/api/segment/get/account\n# Snowflake模式获取唯一ID\nhttp://localhost:8080/api/snowflake/get/pay\nhttp://localhost:8080/api/snowflake/get/account\n</code></pre>\n<p><img src=\"https://raw.githubusercontent.com/Nanzet/nanzet-imgs/master/images/2020061005.jpg\" alt=\"\" loading=\"lazy\" class=\"φbp\"></p>\n<p> Segment模式监控页面：</p>\n<p><code>http://localhost:8080/cache</code></p>\n<p><img src=\"https://raw.githubusercontent.com/Nanzet/nanzet-imgs/master/images/2020061006.jpg\" alt=\"\" loading=\"lazy\" class=\"φbp\"></p>\n","prev":{"title":"V2Ray安装教程（初阶）","link":"2020/07/04/V2Ray安装教程（初阶）"},"next":{"title":"A gift","link":"2020/02/19/A-gift"},"plink":"https://nanzet.cn/2020/06/11/了解美团点评分布式ID生成系统--Leaf/","reward":true,"copyright":{"author":"Nanzet","link":"<a href=\"https://nanzet.cn/2020/06/11/了解美团点评分布式ID生成系统--Leaf/\" title=\"理解美团点评分布式ID生成系统--Leaf\">https://nanzet.cn/2020/06/11/了解美团点评分布式ID生成系统--Leaf/</a>","license":"Attribution-NonCommercial-NoDerivatives 4.0 International (<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow noopener\" target=\"_blank\">CC BY-NC-ND 4.0</a>)"},"reading_time":"560 字约 4 分钟"}