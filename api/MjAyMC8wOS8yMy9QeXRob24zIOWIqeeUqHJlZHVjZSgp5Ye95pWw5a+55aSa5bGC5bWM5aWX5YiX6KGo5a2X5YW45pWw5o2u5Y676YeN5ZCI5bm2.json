{"title":"Python3 利用reduce()方法对多层嵌套列表字典数据去重合并（进阶）","date":"2020-09-23T22:11:00.000Z","date_formatted":{"ll":"2020年9月23日","L":"2020/09/23","MM-DD":"09-23"},"author":"Nanzet","link":"2020/09/23/Python3 利用reduce()函数对多层嵌套列表字典数据去重合并","tags":["Python","reduce函数","去重","嵌套字典列表"],"categories":["技术"],"updated":"2022-11-19T15:43:12.598Z","content":"<h4 id=\"1、需求场景\">1、需求场景<a title=\"#1、需求场景\" href=\"#1、需求场景\"></a></h4>\n<p> 基于角色的权限设计，在登录接口中对当前用户角色权限的权限字典进行构造，由于当前用户可能拥有多个角色（普通用户、管理员1、管理员2、超级管理员…），导致权限数据字典可能会出现这种情况：权限字典列表中，不同角色模块字典下具有相同、不同或部分的接口代号、地址。</p>\n<p> 以下方法可以对当前场景下多层嵌套的列表字典数据进行去重并合并同模块的接口数据，可以根据业务需求修改下面的代码。</p>\n<h4 id=\"2、功能测试代码\">2、功能测试代码<a title=\"#2、功能测试代码\" href=\"#2、功能测试代码\"></a></h4>\n<pre><code class=\"language-python\"># coding=utf-8\n\nfrom functools import reduce\n\n# 测试数据，权限字典列表；第一层字典的键不同的数字表示不同的模块\naa = [\n    &#123;\n        '2': &#123;\n            'codes': ['list', 'tree', 'add', 'delete', 'update', 'detail', 'import', 'generate', 'export'],\n            'urls': ['/users/rm/searchlt', '/users/rm/ltree', '/users/addRisk', '/users/rm/delete', '/users/risk/update', '/users/rm/detail', '/users/rm/risk/import', '/users/rm/risk/export', '/users/rm/risk/download']\n        &#125;,\n        '4': &#123;\n            'codes': ['list', 'tree', 'add', 'delete', 'update', 'detail'],\n            'urls': ['/users/sm/searchlt', '/users/sm/ltree', '/users/addStrategy', '/users/sm/delete', '/users/strategy/update', '/users/sm/detail']\n        &#125;\n    &#125;,\n    &#123;\n        '1': &#123;\n            'codes': ['list', 'tree', 'add1', 'add2', 'delete', 'update', 'detail'],\n            'urls': ['/users/bm/searchlt', '/users/bm/ltree', '/users/addbaseAsset', '/users/addptAsset', '/users/bm/delete', '/users/asset/update', '/users/bm/detail']\n        &#125;,\n        '4': &#123;\n            'codes': ['list', 'tree', 'add', 'delete', 'update', 'detail'],\n            'urls': ['/users/sm/searchlt', '/users/sm/ltree', '/users/addStrategy', '/users/sm/delete', '/users/strategy/update', '/users/sm/detail']\n        &#125;\n    &#125;,\n    &#123;\n        '3': &#123;\n            'codes': ['selDetail', 'tree', 'add', 'update', 'delete'],\n            'urls': ['/users/szm/searchlt', '/users/szm/ltree', '/users/sz', '/users/sz/update', '/users/szm/delete']\n        &#125;\n    &#125;\n]\n\n\ndef sum_dict(a, b):\n    temp = dict()\n    # 获取a, b字典中的键值列表，不改变原来的元素顺序去重\n    union_keys = list(a.keys()) + list(b.keys())\n    new_keys = list(set(union_keys))\n    new_keys.sort(key=union_keys.index)\n    for key in new_keys:\n        print(key)  # '2'\n        # 可以根据业务需求修改下面的代码\n        m = 0\n        for d in (a, b):\n            d = d.get(key)\n            print(d)\n            if d:\n                m = m + 1\n                # 对于a, b字典中重复出现的键里可能存在对应值不相同的情况，取并集并做格式转换\n                if m == 2:\n                    union_codes_list = a.get(key).get(\n                        'codes') + b.get(key).get('codes')    # list\n                    union_urls_list = a.get(key).get(\n                        'urls') + b.get(key).get('urls')\n                    new_codes = list(set(union_codes_list))\n                    new_urls = list(set(union_urls_list))\n                    # set后不改变原来元素顺序\n                    new_codes.sort(key=union_codes_list.index)\n                    new_urls.sort(key=union_urls_list.index)\n                    temp[key] = &#123;&quot;codes&quot;: new_codes, &quot;urls&quot;: new_urls&#125;\n                else:\n                    temp[key] = d\n\n    return temp\n\n\nperm_dict = reduce(sum_dict, aa)\n\nprint(perm_dict)\n</code></pre>\n<h4 id=\"3、运行结果\">3、运行结果<a title=\"#3、运行结果\" href=\"#3、运行结果\"></a></h4>\n<pre><code class=\"language-json\">&#123;\n  &quot;2&quot;: &#123;\n    &quot;codes&quot;: [&quot;list&quot;, &quot;tree&quot;, &quot;add&quot;, &quot;delete&quot;, &quot;update&quot;, &quot;detail&quot;, &quot;import&quot;, &quot;generate&quot;, &quot;export&quot;],\n    &quot;urls&quot;: [\n      &quot;/users/rm/searchlt&quot;,\n      &quot;/users/rm/ltree&quot;,\n      &quot;/users/addRisk&quot;,\n      &quot;/users/rm/delete&quot;,\n      &quot;/users/risk/update&quot;,\n      &quot;/users/rm/detail&quot;,\n      &quot;/users/rm/risk/import&quot;,\n      &quot;/users/rm/risk/export&quot;,\n      &quot;/users/rm/risk/download&quot;\n    ]\n  &#125;,\n  &quot;4&quot;: &#123;\n    &quot;codes&quot;: [&quot;list&quot;, &quot;tree&quot;, &quot;add&quot;, &quot;delete&quot;, &quot;update&quot;, &quot;detail&quot;],\n    &quot;urls&quot;: [\n      &quot;/users/sm/searchlt&quot;,\n      &quot;/users/sm/ltree&quot;,\n      &quot;/users/addStrategy&quot;,\n      &quot;/users/sm/delete&quot;,\n      &quot;/users/strategy/update&quot;,\n      &quot;/users/sm/detail&quot;\n    ]\n  &#125;,\n  &quot;1&quot;: &#123;\n    &quot;codes&quot;: [&quot;list&quot;, &quot;tree&quot;, &quot;add1&quot;, &quot;add2&quot;, &quot;delete&quot;, &quot;update&quot;, &quot;detail&quot;],\n    &quot;urls&quot;: [\n      &quot;/users/bm/searchlt&quot;,\n      &quot;/users/bm/ltree&quot;,\n      &quot;/users/addbaseAsset&quot;,\n      &quot;/users/addptAsset&quot;,\n      &quot;/users/bm/delete&quot;,\n      &quot;/users/asset/update&quot;,\n      &quot;/users/bm/detail&quot;\n    ]\n  &#125;,\n  &quot;3&quot;: &#123;\n    &quot;codes&quot;: [&quot;selDetail&quot;, &quot;tree&quot;, &quot;add&quot;, &quot;update&quot;, &quot;delete&quot;],\n    &quot;urls&quot;: [\n      &quot;/users/szm/searchlt&quot;,\n      &quot;/users/szm/ltree&quot;,\n      &quot;/users/sz&quot;,\n      &quot;/users/sz/update&quot;,\n      &quot;/users/szm/delete&quot;\n    ]\n  &#125;\n&#125;\n</code></pre>\n","prev":{"title":"解决Navicat Premium 12远程连接数据库PostgreSQL 12报错的问题","link":"2020/09/23/解决Navicat Premium 12远程连接数据库PostgreSQL 12报错的问题"},"next":{"title":"解决VScode自动将lambda表达式转换为def的问题","link":"2020/09/23/解决VScode自动将lambda表达式转换为def的问题"},"plink":"https://nanzet.cn/2020/09/23/Python3 利用reduce()函数对多层嵌套列表字典数据去重合并/","reward":true,"copyright":{"author":"Nanzet","link":"<a href=\"https://nanzet.cn/2020/09/23/Python3 利用reduce()函数对多层嵌套列表字典数据去重合并/\" title=\"Python3 利用reduce()方法对多层嵌套列表字典数据去重合并（进阶）\">https://nanzet.cn/2020/09/23/Python3 利用reduce()函数对多层嵌套列表字典数据去重合并/</a>","license":"Attribution-NonCommercial-NoDerivatives 4.0 International (<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow noopener\" target=\"_blank\">CC BY-NC-ND 4.0</a>)"},"reading_time":"677 字约 5 分钟"}